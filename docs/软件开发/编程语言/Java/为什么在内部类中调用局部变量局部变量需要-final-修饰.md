# 为什么在内部类中调用局部变量局部变量需要 final 修饰

> 以前就有不懂，今天稍微搞懂了，赶紧记下来

首先在方法中声明一个内部类，比如一个回调，在这个内部类中用了一个局部变量。在声明的时候是不会去执行这个方法的，只有你实例化了这个内部类，然后调用他的方法，才会去执行这个内部类中的代码。

而这时候声明这个内部类的方法早都执行完毕了，里面的方法栈都清空了，内部类所引用的局部变量已经被 GC 了。

这就很矛盾，一个内部类去引用一个已经被回收的局部变量。

为了解决这个问题，Java 在内部类引用局部变量的时候就自行保存了一份变量声明，在底层实现中，其实内部类用的是自己的变量，没有引用代码中写的那个局部变量，这样这个矛盾就解决了。

但是又出现一个新的问题，就是如果在声明内部类的方法中，在声明内部类后改变了这个局部变量的值，因为此时内部类用的变量已经不是那个成员变量了，所以内部类的变量的值并不会跟着改变，这时候就会有严重的逻辑错误。

为了避免这个问题，将局部变量加上 final 修饰，貌似是最好的解决方案。

不知道理解的对不对，还需要加深理解